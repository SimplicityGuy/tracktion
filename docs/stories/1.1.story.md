# Story 1.1: Project Setup & Dockerization

## Story Information
- **Epic**: 1 - Foundation & Core Services
- **Story Number**: 1.1
- **Status**: Ready for Review
- **Created**: 2025-08-16
- **Updated**: 2025-08-16

## Story Statement
**As a** music-loving developer,
**I want** a project with a defined monorepo structure and Docker configurations,
**so that** I can easily set up the development environment and prepare for deployment.

## Acceptance Criteria
1. The project repository contains a `docker-compose.yaml` file to orchestrate all services.
2. The project structure adheres to the defined monorepo pattern.
3. A basic Python service is containerized and runs successfully via `docker-compose`.

## Dev Notes

### Previous Story Insights
No previous story exists - this is the first story of the project.

### Project Structure Requirements
The project must follow the monorepo structure defined in the architecture document. [Source: docs/architecture.md#Source Tree]

**Required Directory Structure:**
```
tracktion/
├── services/
│   ├── file_watcher/
│   │   ├── src/
│   │   ├── Dockerfile
│   │   └── pyproject.toml
│   ├── cataloging_service/
│   │   ├── src/
│   │   ├── Dockerfile
│   │   └── pyproject.toml
│   ├── analysis_service/
│   │   ├── src/
│   │   ├── Dockerfile
│   │   └── pyproject.toml
│   └── tracklist_service/
│       ├── src/
│       ├── Dockerfile
│       └── pyproject.toml
├── docs/
│   ├── architecture.md
│   ├── prd.md
│   └── project-brief.md
├── shared/
│   ├── core_types/
│   │   └── pyproject.toml
│   ├── docker/
│   ├── utils/
│   └── pyproject.toml
├── infrastructure/
│   ├── docker-compose.yaml
│   └── rabbitmq/
│       └── definitions.json
├── tests/
│   ├── unit/
│   └── integration/
├── .env.example
├── README.md
└── pyproject.toml
```

### Technical Stack Configuration
[Source: docs/architecture.md#Tech Stack]

**Python Configuration:**
- Version: Python 3.12+
- Package Management: `uv` for dependency management
- Linting: `ruff` for code quality
- Type Checking: `mypy` for static type checking
- Testing Framework: `pytest` for unit and integration tests

**Infrastructure Components to Configure:**
- PostgreSQL (primary data store)
- Neo4j (graph database)
- Redis (caching service)
- RabbitMQ (message queue)
- Docker (containerization)

**Database Tools:**
- ORM: SQLAlchemy
- Migration Tool: Alembic

### Docker Configuration Requirements
[Source: docs/architecture.md#Infrastructure and Deployment]

**Docker Compose Setup:**
- Location: `infrastructure/docker-compose.yaml`
- Must orchestrate all services and datastores
- Each service must have its own Dockerfile for independent containerization
- Services to include in docker-compose:
  - file_watcher service
  - cataloging_service
  - analysis_service  
  - tracklist_service
  - PostgreSQL database
  - Neo4j database
  - Redis cache
  - RabbitMQ message queue

### Coding Standards Configuration
[Source: docs/architecture.md#Coding Standards]

**Mandatory Standards:**
- Line Length: Maximum 120 characters
- Import Sorting: Use `isort`
- Pre-commit Hooks: Must be configured
- Configuration Management: All connection strings must use environment variables
- All services must be configured via `pyproject.toml`

### Environment Configuration
[Source: docs/architecture.md#Infrastructure and Deployment]

**Environment Setup:**
- Create `.env.example` file with all required environment variables
- Must include connection strings for all datastores
- Must not contain any actual secrets or passwords
- Development environment runs all services via `docker-compose`

### Testing Requirements
[Source: docs/architecture.md#Test Strategy and Standards]

**Initial Test Setup:**
- Create `tests/unit/` directory structure
- Create `tests/integration/` directory structure
- Configure `pytest` in root `pyproject.toml`
- Test files must follow `test_*.py` naming convention

### File Locations
Based on the project structure, new files should be created at:
- `infrastructure/docker-compose.yaml` - Main Docker orchestration file
- `services/file_watcher/Dockerfile` - File watcher service container
- `services/file_watcher/pyproject.toml` - File watcher dependencies
- `services/file_watcher/src/__init__.py` - Initial Python package file
- `.env.example` - Environment variable template
- `pyproject.toml` - Root project configuration
- `README.md` - Project documentation

### Technical Constraints
- Must use Python 3.12+ for all services
- All services must be independently containerized
- Services must communicate only via RabbitMQ (no direct HTTP calls between services)
- Database interactions must go through ORM/repository layer only
- No hardcoded configuration values - use environment variables

## Tasks / Subtasks

### 1. Create Base Project Structure (AC: 2)
- [x] Create all required directories as per architecture specification
- [x] Initialize root `pyproject.toml` with project metadata
- [x] Create `.env.example` with placeholder environment variables
- [x] Create initial README.md with setup instructions

### 2. Setup Python Development Environment (AC: 2)
- [x] Configure `uv` for dependency management in root `pyproject.toml`
- [x] Configure `ruff` for linting with 120 character line limit
- [x] Configure `mypy` for type checking
- [x] Configure `isort` for import sorting
- [x] Setup `pre-commit` hooks configuration

### 3. Create Initial File Watcher Service (AC: 3)
- [x] Create `services/file_watcher/` directory structure
- [x] Initialize `services/file_watcher/pyproject.toml` with service dependencies
- [x] Create basic Python application in `services/file_watcher/src/`
- [x] Write Dockerfile for file_watcher service
- [x] Add unit test structure in `tests/unit/file_watcher/`

### 4. Configure Docker Infrastructure (AC: 1, 3)
- [x] Create `infrastructure/docker-compose.yaml` with all service definitions
- [x] Configure PostgreSQL service in docker-compose
- [x] Configure Neo4j service in docker-compose
- [x] Configure Redis service in docker-compose
- [x] Configure RabbitMQ service with `rabbitmq/definitions.json`
- [x] Link file_watcher service to docker-compose

### 5. Validate Docker Setup (AC: 1, 3)
- [x] Test `docker-compose up` command successfully starts all services
- [x] Verify file_watcher service runs without errors
- [x] Verify all datastores are accessible
- [x] Verify RabbitMQ management interface is accessible
- [x] Document any setup issues or requirements

### 6. Create Initial Tests (AC: 3)
- [x] Write basic smoke test for file_watcher service
- [x] Write docker-compose validation test
- [x] Configure pytest to run all tests
- [x] Verify tests pass in containerized environment

## Project Structure Notes
The architecture document provides a clear monorepo structure that must be followed exactly. All services are organized under `services/` with shared code in `shared/` and infrastructure configuration in `infrastructure/`. This structure supports the microservices architecture pattern specified in the PRD.

## Dev Agent Record
*This section will be populated by the Dev Agent during implementation*

### Implementation Notes
- Created complete monorepo structure following architecture specifications
- Configured Python development environment with uv, ruff, mypy, and pre-commit
- Implemented basic file_watcher service with proper structure and logging
- Set up Docker infrastructure with all required services and health checks
- All services properly networked and configured with environment variables 

### Challenges Encountered
- None - all tasks completed successfully on first attempt 

### Technical Decisions
- Used Alpine-based Docker images for smaller footprint
- Implemented structured logging with structlog for better observability
- Created placeholder services for cataloging, analysis, and tracklist to validate docker-compose
- Used health checks for all datastores to ensure proper startup order
- Updated all dependencies to latest stable versions (Python 3.13, PostgreSQL 17, Neo4j 5.26, Redis 7.4, RabbitMQ 4.0)
- Implemented pre-commit hooks with frozen versions using `pre-commit autoupdate --freeze`
- Established dependency management policy requiring latest stable versions 

### Debug Log References
- 

### Completion Notes
- All acceptance criteria met successfully
- Docker compose configuration validated
- File watcher service containerized and ready
- All tests passing

### File List
- pyproject.toml
- .env.example
- README.md
- .pre-commit-config.yaml
- services/file_watcher/pyproject.toml
- services/file_watcher/src/__init__.py
- services/file_watcher/src/main.py
- services/file_watcher/Dockerfile
- infrastructure/docker-compose.yaml
- infrastructure/rabbitmq/definitions.json
- infrastructure/data/music/ (directory)
- tests/__init__.py
- tests/unit/__init__.py
- tests/unit/file_watcher/__init__.py
- tests/unit/file_watcher/test_main.py
- tests/integration/__init__.py
- tests/integration/test_docker_compose.py
- shared/pyproject.toml
- shared/core_types/pyproject.toml 

---
*End of Story 1.1*